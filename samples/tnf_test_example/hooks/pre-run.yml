---
- name: "Install required rpm packages"
  package:
    name: "{{ item }}"
    state: present
  loop:
    - curl
    - python3-openshift
    - python3-pyyaml
  become: true

- name: Declare tnf variables
  include_tasks: declare_tnf_variables.yml

- name: Mirror images in disconnected environments
  include_role:
    name: mirror_images
  vars:
    images:
      - quay.io/testnetworkfunction/cnf-test-partner:latest
      - "{{ tnf_helm_chart_to_install.image_repository }}:{{ tnf_helm_chart_to_install.app_version }}"
    local_registry: "{{ provisionhost_registry }}"
    authfile: "{{ pullsecret_tmp_file }}"
  when:
    - dci_disconnected | default(false) | bool
    - provisionhost_registry|length
    - pullsecret_tmp_file|length

# Following the same scope than in preflight for preparing the operator in disconnected environments
- name: Preparing the operator in disconnected environments
  include_tasks: prepare_operator.yml
  when:
    - dci_disconnected | default(false) | bool
    - provisionhost_registry|length
    - pullsecret_tmp_file|length

...
