---

- name: Create CatalogSource for operator
  community.kubernetes.k8s:
    state: present
    definition:
      apiVersion: operators.coreos.com/v1alpha1
      kind: CatalogSource
      metadata:
        name: "{{ tnf_operator_to_install.operator_name }}-catalog"
        namespace: openshift-marketplace
      spec:
        sourceType: grpc
        image: "{{ catalog_path | default('registry.redhat.io/redhat/certified-operator-index:v' + ocp_version) }}"
        displayName: Operator
        updateStrategy:
          registryPoll:
            interval: 30m

- name: "deploy-operators : Install operator"
  include_role:
    name: olm-operator
  vars:
    operator: "{{ tnf_operator_to_install.operator_name }}"
    source: "{{ tnf_operator_to_install.operator_name }}-catalog"
    namespace: "{{ target_ns }}"
    operator_group_spec:
      targetNamespaces:
        - "{{ target_ns }}"

...
